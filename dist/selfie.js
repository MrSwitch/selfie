!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _utilsDomAppendJs=require("../utils/dom/append.js"),_utilsDomAppendJs2=_interopRequireDefault(_utilsDomAppendJs),_utilsDomQueryJs=require("../utils/dom/query.js"),_utilsDomQueryJs2=_interopRequireDefault(_utilsDomQueryJs),_utilsStringParamJs=require("../utils/string/param.js"),_utilsStringParamJs2=_interopRequireDefault(_utilsStringParamJs),_utilsEventsOnJs=require("../utils/events/on.js"),_utilsEventsOnJs2=_interopRequireDefault(_utilsEventsOnJs),viewerCSSText=_utilsStringParamJs2["default"]({position:"fixed",left:0,right:0,top:0,bottom:0,"z-index":1,"background-color":"rgba(0,0,0,0.8)"},";",":"),viewerContentCSSText=_utilsStringParamJs2["default"]({position:"absolute",left:"5%",right:"5%",top:"5%",bottom:"5%","text-align":"center"},";",":"),viewerImgCSSText=_utilsStringParamJs2["default"]({"max-width":"100%","max-height":"100%"},";",":");exports["default"]=function(url){var elm=_utilsDomQueryJs2["default"](".viewer"),content=_utilsDomQueryJs2["default"](".viewer-content");if(elm)elm.hidden&&(elm.hidden=!1);else{elm=_utilsDomAppendJs2["default"]("div",{"class":"viewer",style:viewerCSSText});var controls=_utilsDomAppendJs2["default"]("div",{"class":"viewer-controls"},elm),close_btn=_utilsDomAppendJs2["default"]("button",{"class":"viewer-close",onclick:function(){elm.hidden=!0}},controls);close_btn.appendChild(document.createTextNode("X")),content=_utilsDomAppendJs2["default"]("div",{"class":"viewer-content",style:viewerContentCSSText},elm),_utilsEventsOnJs2["default"](document,"keypress",function(e){elm.hidden||32!==e.keyCode||(elm.hidden=!0,e.preventDefault(),e.stopPropagation())})}content.innerHTML="";_utilsDomAppendJs2["default"]("img",{src:url,style:viewerImgCSSText},content)},module.exports=exports["default"]},{"../utils/dom/append.js":3,"../utils/dom/query.js":9,"../utils/events/on.js":10,"../utils/string/param.js":14}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function keypress(e){32===e.charCode&&record()}function record(){stream&&stream.active?source.canvas.toBlob(handleBlob):cameraPower()}function handleBlob(blob){var photos=getPhotos(),url=URL.createObjectURL(blob);_utilsDomAppendJs2["default"]("img",{src:url,width:"100px",style:imgCSSText,onclick:function(){_libViewerJs2["default"](url)}},photos)}function cameraPower(){_utilsSupportGetUserMediaJs2["default"]({video:!0,audio:!0},cameraOn,cameraOff)}function cameraOn(_stream){stream=_stream,video=getVideo(_stream),source=getCanvasContext(),draw()}function draw(){var _objectFit=_utilsDomObjectfitJs2["default"](video.videoWidth,video.videoHeight,source.canvas.width,source.canvas.height),_objectFit2=_slicedToArray(_objectFit,4),x=_objectFit2[0],y=_objectFit2[1],w=_objectFit2[2],h=_objectFit2[3];source.drawImage(video,x,y,w,h),_utilsSupportRequestAnimationFrameJs2["default"](draw)}function cameraOff(e){console.log(e)}function getVideo(stream){var elm=_utilsDomQueryJs2["default"]("#source",container);return elm||(elm=_utilsDomAppendJs2["default"]("video",{id:"source",style:videoCSSText,hidden:!0},container)),elm.src=window.URL.createObjectURL(stream),elm.muted=!0,elm.autoplay=!0,elm.play(),elm.onerror=function(event){stream.stop()},elm}function getCanvasContext(){var elm=_utilsDomQueryJs2["default"]("canvas",container);return elm||(elm=_utilsDomAppendJs2["default"]("canvas",{style:canvasCSSText},container)),elm.width=elm.clientWidth,elm.height=elm.clientHeight,elm.getContext("2d")}function getPhotos(){var elm=_utilsDomQueryJs2["default"]("div.photos");return elm||(elm=_utilsDomAppendJs2["default"]("div",{"class":"photos",style:photosCSSText},container)),elm}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_utilsEventsOnJs=require("./utils/events/on.js"),_utilsEventsOnJs2=_interopRequireDefault(_utilsEventsOnJs),_utilsEventsReadyJs=require("./utils/events/ready.js"),_utilsEventsReadyJs2=_interopRequireDefault(_utilsEventsReadyJs),_utilsSupportGetUserMediaJs=require("./utils/support/getUserMedia.js"),_utilsSupportGetUserMediaJs2=_interopRequireDefault(_utilsSupportGetUserMediaJs),_utilsSupportRequestAnimationFrameJs=require("./utils/support/requestAnimationFrame.js"),_utilsSupportRequestAnimationFrameJs2=_interopRequireDefault(_utilsSupportRequestAnimationFrameJs),_utilsDomAppendJs=require("./utils/dom/append.js"),_utilsDomAppendJs2=_interopRequireDefault(_utilsDomAppendJs),_utilsDomQueryJs=require("./utils/dom/query.js"),_utilsDomQueryJs2=_interopRequireDefault(_utilsDomQueryJs),_utilsStringParamJs=require("./utils/string/param.js"),_utilsStringParamJs2=_interopRequireDefault(_utilsStringParamJs),_utilsDomObjectfitJs=require("./utils/dom/objectfit.js"),_utilsDomObjectfitJs2=_interopRequireDefault(_utilsDomObjectfitJs);require("./utils/support/canvasToBlob.js");var container,video,source,stream,_libViewerJs=require("./lib/viewer.js"),_libViewerJs2=_interopRequireDefault(_libViewerJs),canvasCSSText=_utilsStringParamJs2["default"]({position:"absolute",left:0,top:0,width:"100%",height:"100%","background-color":"#ccc"},";",":"),videoCSSText=_utilsStringParamJs2["default"]({display:"none"},";",":"),photosCSSText=_utilsStringParamJs2["default"]({position:"absolute",bottom:0,left:0,right:0},";",":"),imgCSSText=_utilsStringParamJs2["default"]({display:"inline-block",border:"10px solid white"},";",":");_utilsEventsReadyJs2["default"](function(){container=_utilsDomQueryJs2["default"](".selfie"),source=getCanvasContext(),_utilsEventsOnJs2["default"](source.canvas,"click, touchstart",record),cameraPower(),_utilsEventsOnJs2["default"](window,"resize",getCanvasContext),_utilsEventsOnJs2["default"](document,"keypress",keypress)})},{"./lib/viewer.js":1,"./utils/dom/append.js":3,"./utils/dom/objectfit.js":8,"./utils/dom/query.js":9,"./utils/events/on.js":10,"./utils/events/ready.js":11,"./utils/string/param.js":14,"./utils/support/canvasToBlob.js":15,"./utils/support/getUserMedia.js":16,"./utils/support/requestAnimationFrame.js":17}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _createElementJs=require("./createElement.js"),_createElementJs2=_interopRequireDefault(_createElementJs);exports["default"]=function(tagName,prop){var parent=arguments.length<=2||void 0===arguments[2]?document.body:arguments[2],elm=_createElementJs2["default"](tagName,prop);return parent.appendChild(elm),elm},module.exports=exports["default"]},{"./createElement.js":5}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _eachJs=require("./each.js"),_eachJs2=_interopRequireDefault(_eachJs);exports["default"]=function(elements,props){return _eachJs2["default"](elements,function(element){for(var x in props){var prop=props[x];"function"==typeof prop?element[x]=prop:element.setAttribute(x,prop)}})},module.exports=exports["default"]},{"./each.js":6}],5:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _attrJs=require("./attr.js"),_attrJs2=_interopRequireDefault(_attrJs);exports["default"]=function(tagName,attrs){var elm=document.createElement(tagName);return _attrJs2["default"](elm,attrs),elm},module.exports=exports["default"]},{"./attr.js":4}],6:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _isDomJs=require("./isDom.js"),_isDomJs2=_interopRequireDefault(_isDomJs),_objectInstanceOfJs=require("../object/instanceOf.js"),_objectInstanceOfJs2=_interopRequireDefault(_objectInstanceOfJs),_objectToArrayJs=require("../object/toArray.js"),_objectToArrayJs2=_interopRequireDefault(_objectToArrayJs);exports["default"]=function(matches){var callback=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return _isDomJs2["default"](matches)?matches=[matches]:"string"==typeof matches&&(matches=document.querySelectorAll(matches)),_objectInstanceOfJs2["default"](matches,Array)||(matches=_objectToArrayJs2["default"](matches)),callback&&matches.forEach(callback),matches},module.exports=exports["default"]},{"../object/instanceOf.js":12,"../object/toArray.js":13,"./isDom.js":7}],7:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _objectInstanceOfJs=require("../object/instanceOf.js"),_objectInstanceOfJs2=_interopRequireDefault(_objectInstanceOfJs),_HTMLElement="undefined"!=typeof HTMLElement?HTMLElement:Element,_HTMLDocument="undefined"!=typeof HTMLDocument?HTMLDocument:Document,_Window=window.constructor;exports["default"]=function(test){return _objectInstanceOfJs2["default"](test,_HTMLElement)||_objectInstanceOfJs2["default"](test,_HTMLDocument)||_objectInstanceOfJs2["default"](test,_Window)},module.exports=exports["default"]},{"../object/instanceOf.js":12}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(item_width,item_height,target_width,target_height){var item_r=item_height/item_width,target_r=target_height/target_width,offsetLeft=0,offsetTop=0;return target_r>item_r?offsetLeft=Math.round(target_height/item_r-target_width):item_r>target_r&&(offsetTop=Math.round(target_width*item_r-target_height)),[-offsetLeft/2,-offsetTop/2,target_width+offsetLeft,target_height+offsetTop]},module.exports=exports["default"]},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(query){var parent=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return parent.querySelector(query)},module.exports=exports["default"]},{}],10:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _domEachJs=require("../dom/each.js"),_domEachJs2=_interopRequireDefault(_domEachJs),SEPERATOR=/[\s\,]+/;exports["default"]=function(elements,eventnames,callback){var useCapture=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];return eventnames=eventnames.split(SEPERATOR),_domEachJs2["default"](elements,function(el){eventnames.forEach(function(eventname){return el.addEventListener(eventname,callback,useCapture)})})},module.exports=exports["default"]},{"../dom/each.js":6}],11:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _onJs=require("./on.js"),_onJs2=_interopRequireDefault(_onJs);exports["default"]=function(callback){"loading"!==document.readyState&&document.body?callback():_onJs2["default"](document,"DOMContentLoaded",callback)},module.exports=exports["default"]},{"./on.js":10}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(test,root){return root&&test instanceof root},module.exports=exports["default"]},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(obj){return Array.prototype.slice.call(obj)},module.exports=exports["default"]},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(hash){var delimiter=arguments.length<=1||void 0===arguments[1]?"&":arguments[1],seperator=arguments.length<=2||void 0===arguments[2]?"=":arguments[2],formatFunction=arguments.length<=3||void 0===arguments[3]?function(o){return o}:arguments[3];return Object.keys(hash).map(function(name){var value=formatFunction(hash[name]);return name+(null!==value?seperator+value:"")}).join(delimiter)},module.exports=exports["default"]},{}],15:[function(require,module,exports){"use strict";function canvasToBlob(callback,type,quality){for(var binStr=atob(this.toDataURL(type,quality).split(",")[1]),len=binStr.length,arr=new Uint8Array(len),i=0;len>i;i++)arr[i]=binStr.charCodeAt(i);callback(new Blob([arr],{type:type||"image/png"}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=canvasToBlob,HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:canvasToBlob}),module.exports=exports["default"]},{}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia||function(c,s,e){e(new Error("getUserMedia is not supported"))}).bind(navigator);exports["default"]=function(constraints,success,failure){try{_getUserMedia(constraints,success,failure)}catch(e){try{_getUserMedia(Object.keys(constraints).join(","),success,failure)}catch(_e){failure()}}},module.exports=exports["default"]},{}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},exports["default"]=window.requestAnimationFrame.bind(window),module.exports=exports["default"]},{}]},{},[2]);
//# sourceMappingURL=selfie.js.map